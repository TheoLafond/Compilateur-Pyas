<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Python assembler compilator: Scripts de test Python3 pour les increments 1 et 2 du projet informatique 2022-23</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Python assembler compilator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_tests_integration__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Scripts de test Python3 pour les increments 1 et 2 du projet informatique 2022-23 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md8"></a>
1. Introduction au script python3 &lt;tt&gt;execute_tests.py&lt;/tt&gt;</h1>
<p ><code>execute_tests.py</code> est un script python3 qui exécute une suite de tests spécifiée dans des fichiers d'extension <code>.test</code> et génère un rapport en comparant :</p>
<ul>
<li>le code d'erreur (<em>return code</em>) du programme testé ;</li>
<li>les sorties (<code>stdout</code> et <code>stderr</code>) du programme testé</li>
</ul>
<p >avec un oracle spécifié dans le fichier <code>.test</code>.</p>
<p >Il détecte également les erreurs de segmentation.</p>
<p >Il dispose d'une option permettant d'exécuter le programme à tester dans <code>valgrind</code> et de rapporter les erreurs <code>valgrind</code>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
2. Installation / prérequis</h1>
<p >Ce script nécessite <code>python3</code> et le package python3 <code>pexpect</code> et <code>termcolor</code>. Il est également conseillé de disposer du comparateur de fichiers texte <code>meld</code>.</p>
<p >Si <code>python3</code> et <code>pip3</code> sont déjà installés, pour configurer sur une machine école ou la machine virtuelle Phelma, exécuter les commandes suivantes : </p><div class="fragment"><div class="line">pip3 install pexpect --user</div>
<div class="line">pip3 install termcolor --user</div>
<div class="line">sudo yum install meld</div>
</div><!-- fragment --><p> <em>Les deux premières commandes installent les package python3 nécessaires au niveau "utilisateur" (ces commandes devront être répétées sur chaque compte utilisateur). La dernière commande installe le comparateur de fichier texte <code>meld</code>.</em></p>
<h1><a class="anchor" id="autotoc_md10"></a>
3. Structure d'un fichier &lt;tt&gt;.test&lt;/tt&gt;</h1>
<p >Le script utilise des fichiers d'extension <code>.test</code>, qui doivent respecter une syntaxe spécifique. Un fichier <code>.test</code> spécifie un ou plusieurs tests à effectuer, déterminés par la liste des arguments à passer au programme à tester, ainsi que les résultats attendus (**"oracles"**) pour chacun de ces tests. Voici un exemple de fichier <code>.test</code> contenant 2 tests, pour le programme de matching d'expressions régulières fourni au début du projet, qui donc prend 2 arguments en ligne de commande : </p><div class="fragment"><div class="line"># TEST START ###################################################################</div>
<div class="line"># Test args              : &#39;a*&#39;      &#39;aabbbccccddddd&#39;</div>
<div class="line"># Test return code       : EXIT_SUCCESS</div>
<div class="line"># Test stdout and stderr :</div>
<div class="line">The start of &#39;aabbbccccddddd&#39; is a*, next: &#39;bbbccccddddd&#39;.</div>
<div class="line"># END Test stdout and stderr</div>
<div class="line"># TEST END   ###################################################################</div>
<div class="line"> </div>
<div class="line"># TEST START ###################################################################</div>
<div class="line"># Test args              : &#39;[a-z&#39;   &#39;abcdef_1234&#39;</div>
<div class="line"># Test return code       : EXIT_FAILURE</div>
<div class="line"># Test stdout and stderr :</div>
<div class="line">Invalid regexp : &#39;[a-z&#39; is an unterminated group of chars.</div>
<div class="line"># END Test stdout and stderr</div>
<div class="line"># TEST END   ###################################################################</div>
</div><!-- fragment --><p> <b>Les éléments importants dans ce fichier sont les suivants</b> (attention à respecter la syntaxe des balises !) :</p>
<ul>
<li><code># TEST START</code> et <code># TEST END</code> : indiquent respectivement le début et la fin de la spécification d'un test ;</li>
<li><code># Test args :</code> : les arguments à passer au programme à tester pour exécuter le test ;</li>
<li><code># Test return code</code> : le <em>code de retour attendu du programme</em>, qui sera comparé au <em>code de retour effectif</em> obtenu lors de l'exécution du programme à tester avec les arguments du test. Doit valoir :<ul>
<li>soit <code>EXIT_SUCCESS</code> si le programme est censé se terminer sans erreur, c'est à dire avec un code erreur nul, (<em>e.g.</em> avec <code>exit(EXIT_SUCCESS);</code>) ;</li>
<li>soit <code>EXIT_FAILURE</code> si le programme est censé se terminer avec un code erreur non nul (<em>e.g.</em> avec <code>exit(EXIT_FAILURE);</code>).</li>
</ul>
</li>
<li><code># Test stdout and stderr :</code> et <code># END Test stdout and stderr</code> : toutes les lignes qui figurent entre ces deux balises constituent la <em>sortie attendue du programme</em>. Cette sortie regroupe la sortie et l'erreur standard (<code>stdout</code> et <code>stderr</code>). Elle sera comparée à la <em>sortie effective</em> obtenue lors de l'exécution du programme à tester avec les arguments du test.</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
4. Exécuter des tests</h1>
<p >Le script Python prend en paramètre un <b>répertoire</b> contenant des fichiers <code>.test</code>.</p>
<p >Il génère une sortie, un <b>répertoire de même nom, suffixé par <code>_result</code></b>, qui contient les résultats des tests.</p>
<p >Par exemple, si le répertoire en entrée s'appelle <code>mes_tests</code>, le répertoire créé en sortie s'appellera <code>mes_tests_result</code>.</p>
<p >Ces deux répertoires peuvent être comparés avec un comparateur de fichier texte, typiquement <code>meld</code> sous Linux.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Exemple d'exécution du script de test</h2>
<p >On suppose dans cet exemple :</p><ul>
<li>que le programme à tester est <code>../../bin/regexp.exe</code> ;</li>
<li>que le répertoire contenant les fichiers <code>.test</code> est <code>./00_test_regexp_basic</code>.</li>
</ul>
<p >Pour exécuter les tests, il faut lancer la commande :</p>
<div class="fragment"><div class="line">./execute_tests.py runtest ../../bin/regexp.exe ./00_test_regexp_basic</div>
</div><!-- fragment --><p >Le script s'exécute alors sur chacun des tests trouvés dans chacun des fichiers <code>.test</code> du répertoire <code>./repertoire_des_tests</code>.</p>
<p >Plus précisément, pour chacun des tests qui se trouve dans l'un des fichiers de test d'extension <code>.test</code> du répertoire <code>./00_test_regexp_basic</code> :</p><ul>
<li>Le script exécute le programme <code>../../bin/regexp.exe</code> avec les arguments du test ;</li>
<li>Le script écrit les résultats dans un autre fichier <code>.test</code>, créé dans un nouveau répertoire nommé <code>./00_test_regexp_basic_result</code> (&lt;= repérer <code>_result</code> à la fin du nom du répertoire résultat).</li>
</ul>
<p >Puis, à l'issue de tous les tests, le script écrit dans le terminal un résumé de tous les tests réalisés, en précisant les tests qui passent (code erreur et sorties conformes à ce qui est attendu), les tests qui ne passent pas (code erreur OU sortie non conforme(s) à ce qui est attendu), les tests qui ont généré une erreur de segmentation, <em>etc</em>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
5. Générer un fichier &lt;tt&gt;.test&lt;/tt&gt; pour ajouter des tests à la base de tests</h1>
<p >Le script permet également de générer un fichier <code>.test</code> à partir d'une série de paramètres placés dans un fichier d'extension <code>.testarg</code>. Cela est utile pour ajouter de nouveaux tests à votre base de tests.</p>
<p >Ce mode utilise des fichiers d'extension <code>.testarg</code>, qui sont très simples : ils contiennent, sur chaque ligne, des arguments à utiliser pour un test.</p>
<p >Exemple de fichier <code>.testarg</code> : </p><div class="fragment"><div class="line"># fichier .testarg permettant de générer un fichier .test au moyen du script python</div>
<div class="line"># Ceci est un commentaire commençant par # =&gt; ignoré.</div>
<div class="line"># Attention : le commentaire doit etre en début de ligne !</div>
<div class="line"> </div>
<div class="line"># 3 séries de paramètres pour générer</div>
<div class="line"># un fichier .test contenant 3 tests</div>
<div class="line"># avec le script execute_tests.py.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">&#39;aa&#39; &#39;aabbcd&#39;</div>
<div class="line"> </div>
<div class="line">&#39;a*&#39; &#39;aabbcd&#39;</div>
<div class="line"> </div>
<div class="line">&#39;a*b*cde&#39; &#39;0123&#39;</div>
</div><!-- fragment --><p >La commande à exécuter pour générer le fichier <code>.test</code> correspondant ressemble alors à ce qui suit (repérer l'option <code>gentest</code> ) :</p>
<div class="fragment"><div class="line">./execute_tests.py gentest ../../bin/regexp.exe ./chemin/monfichier.testarg</div>
</div><!-- fragment --><p >Cette commande va exécuter votre programme <code>../../bin/regexp.exe</code> pour chaque série d'arguments (3 dans le cas du fichier <code>.testarg</code> qui précède), puis générer un fichier <code>.test</code> nommé <code>./chemin/monfichier.test</code>.</p>
<p >Ce fichier <code>.test</code> peut, ultérieurement, être utilisé comme oracle.</p>
<p ><b>Attention : bien sûr, avant d'utiliser le fichier <code>.test</code> ainsi généré comme un oracle, il vous revient de vérifier "à la main", et avec précision, que les sorties générées par votre programme et placées dans le fichier <code>.test</code> sont bien correctes !!</b></p>
<h1><a class="anchor" id="autotoc_md14"></a>
6. Options du script de test</h1>
<p >Pour plus de détails sur les options disponibles dans le script de test, visitez l'aide en ligne : </p><div class="fragment"><div class="line">./execute_tests.py -h</div>
<div class="line">./execute_tests.py runtest -h</div>
<div class="line">./execute_tests.py gentest -h</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
